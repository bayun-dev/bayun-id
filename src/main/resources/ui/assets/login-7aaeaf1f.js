import{u as T,a as b,r as i,j as e,l as F,O as k,B as v,R as y,b as I,i as B,c as C,d as L,I as f,e as P,f as x,C as _,g as q,h as M,k as V,L as K}from"./Checkbox-ab45eaed.js";import{L as p}from"./Link-b31618f7.js";const W=()=>{const t=T(),r=b(),[n,a]=i.useState(""),c={username:n,setUsername:a};return i.useEffect(()=>{n.trim().length===0&&t.pathname!=="/login"&&r("/login")},[n]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col justify-center sm:items-center min-h-full bg-gray-50 gap-6",children:[e.jsxs("a",{className:"flex items-center gap-2 font-logo text-3xl",href:"/",children:[e.jsx("img",{className:"w-8 h-8",src:F,alt:""}),e.jsx("span",{children:"bayun"})]}),e.jsx("div",{className:"w-full sm:w-fit bg-white sm:rounded-lg sm:shadow",children:e.jsx("div",{className:"w-96 p-8 mx-auto",children:e.jsx(k,{context:c})})}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-gray-400 text-base",children:["Don't have Bayun ID? ",e.jsx(p,{href:"/signup",children:"Create ID"})]})})]})})};class z extends v{constructor(r){super(y.POST,"/api/login/availability",r,{headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}})}}const Y=new RegExp("^(?!.*_{2}.*)[a-zA-Z\\d_]{1,30}$"),Z=t=>{if(t.length===0)return"enter a username";if(!Y.test(t))return"invalid username"},$=t=>{if(t.length===0)return"enter a password"},R=i.createContext(void 0),G=t=>{const[r,n]=i.useState(!1),[a,c]=i.useState(void 0),o=()=>{n(!0),c(e.jsx(D,{}))},h=()=>{n(!0),c(e.jsx(Q,{}))},m=()=>{n(!0),c(e.jsx(X,{}))};return e.jsx(R.Provider,{value:{oops:o,blocked:h,deleted:m},children:r?e.jsx(O,{children:a}):t.children})},H=()=>{const t=I();return e.jsx(e.Fragment,{children:e.jsx(O,{children:B(t)&&t.status===404?e.jsx(J,{}):e.jsx(D,{})})})},O=t=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col w-full justify-center items-center text-center py-8 px-4",children:t.children})}),J=()=>e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mb-4 text-7xl tracking-tight font-extrabold lg:text-9xl text-blue-600 dark:text-primary-500",children:"404"}),e.jsx("p",{className:"mb-4 text-3xl tracking-tight font-bold text-gray-900 md:text-4xl dark:text-white",children:"Something's missing."}),e.jsxs("p",{className:"mb-4 text-lg font-light text-gray-500 dark:text-gray-400",children:["Sorry, we can't find that page.",e.jsx("br",{}),e.jsx(p,{href:"/login",children:"Back to log in"})]})]}),D=()=>e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mb-4 text-7xl tracking-tight font-extrabold lg:text-9xl text-blue-600 dark:text-primary-500",children:"OOPS"}),e.jsx("p",{className:"mb-4 text-3xl tracking-tight font-bold text-gray-900 md:text-4xl dark:text-white",children:"Look likes, somethings went wrong."}),e.jsxs("p",{className:"mb-4 text-lg font-light text-gray-500 dark:text-gray-400",children:["We are already working to solve the problem.",e.jsx("br",{}),e.jsx(p,{href:"/login",children:"Back to log in"})]})]}),Q=()=>e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mb-4 text-7xl tracking-tight font-extrabold lg:text-9xl text-blue-600 dark:text-primary-500",children:"ACCOUNT BLOCKED"}),e.jsx("p",{className:"mb-4 text-3xl tracking-tight font-bold text-gray-900 md:text-4xl dark:text-white",children:"Your account has been blocked, we're sorry."}),e.jsx("p",{className:"mb-4 text-lg font-light text-gray-500 dark:text-gray-400",children:e.jsx(p,{href:"/login",children:"Back to log in"})})]}),X=()=>e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mb-4 text-7xl tracking-tight font-extrabold lg:text-9xl text-blue-600 dark:text-primary-500",children:"ACCOUNT DELETED"}),e.jsx("p",{className:"mb-4 text-3xl tracking-tight font-bold text-gray-900 md:text-4xl dark:text-white",children:"Recovering a deleted account is not possible, we're sorry."}),e.jsx("p",{className:"mb-4 text-lg font-light text-gray-500 dark:text-gray-400",children:e.jsx(p,{href:"/login",children:"Back to log in"})})]}),S=()=>{const t=i.useContext(R);if(!t)throw new Error("No LoginErrorProvider not found when calling useLoginError.");return t},ee=()=>{const t=S(),r=C(),n=b(),a=L(),[c,o]=i.useState(void 0),h=j=>{let u=j.currentTarget.value;u&&(u=u.trim()),a.setUsername(u),o(void 0)},m=async()=>{r.show();const j=Z(a.username.trim());if(j){o(j),r.hide();return}new z({username:a.username.trim()}).execute().then(s=>{if(s.status===200)s.data.available?n("/login/continue"):s.data.reason===x.USERNAME_NOT_OCCUPIED?o("Account doesn't exist"):s.data.reason===x.ACCOUNT_BLOCKED?o("Account blocked"):s.data.reason===x.ACCOUNT_DELETED?o("Account deleted"):o("Username not available"),r.hide();else throw new Error},s=>{var d,g;if(s.response.data.errors){const l=(g=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:g.errors;for(let w of l)switch(w.code){case x.USERNAME_INVALID:o("Invalid username");break}r.hide()}else throw new Error}).catch(s=>{r.hide(),t.oops()})};return e.jsx(e.Fragment,{children:e.jsxs("main",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{children:e.jsx("span",{className:"text-2xl font-semibold",children:"Log in"})}),e.jsx("div",{children:e.jsx("span",{className:"text-base text-gray-400",children:"with your Bayun ID"})})]}),e.jsx(f,{placeholder:"Username",errorMessage:c,value:a.username,onChange:h,autoFocus:!0}),e.jsx(P,{type:"dark",onClick:m,children:"Next"})]})})};class te extends v{constructor(r){super(y.POST,"/api/login",r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}const re=()=>{const t=C();b();const r=S(),n=L(),[a,c]=i.useState(""),[o,h]=i.useState(),[m,j]=i.useState(!1),u=d=>{let g=d.currentTarget.value;g&&(g=g.trim()),c(g),h(void 0)},s=async()=>{t.show();const d=$(a);if(d){h(d),t.hide();return}new te({username:n.username,password:a}).execute().then(l=>{if(l.status===200)window.location.replace(l.data.redirectUrl),t.hide();else throw new Error},l=>{var w,E;if(l.response.data.errors){const A=(E=(w=l==null?void 0:l.response)==null?void 0:w.data)==null?void 0:E.errors;for(let U of A)switch(U.code){case x.ACCOUNT_BLOCKED:throw new Error("blocked");case x.ACCOUNT_DELETED:throw new Error("deleted");case x.USERNAME_INVALID:throw new Error;case x.PASSWORD_INVALID:h("invalid password");break;case x.CREDENTIALS_NOT_FOUND:h("incorrect password");break}t.hide()}else throw new Error}).catch(l=>{switch(t.hide(),l.message){case"blocked":r.blocked();break;case"deleted":r.deleted();break;default:r.oops()}})};return e.jsx(e.Fragment,{children:e.jsxs("main",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{children:e.jsx("span",{className:"text-2xl font-semibold",children:"Log in"})}),e.jsx("div",{children:e.jsx("span",{className:"text-base text-gray-400",children:"Welcome back"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{placeholder:"Username",defaultValue:n.username,disabled:!0}),e.jsx(f,{placeholder:"Password",autoFocus:!0,type:m?"text":"password",value:a,onChange:u,errorMessage:o}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(_,{color:"dark",value:m,label:"Show password",onChange:d=>j(d.target.checked)}),e.jsx(p,{href:"/restore/password",children:"Forgot password?"})]})]}),e.jsx("div",{children:e.jsx(P,{type:"dark",onClick:s,children:"Log in"})})]})})},se=()=>e.jsx(e.Fragment,{children:e.jsx(K,{children:e.jsx(G,{children:e.jsx(k,{})})})}),ne=q([{id:"login.root",path:"/",element:e.jsx(se,{}),errorElement:e.jsx(H,{}),children:[{id:"login",path:"/login",element:e.jsx(W,{}),children:[{id:"login.start",path:"/login",element:e.jsx(ee,{})},{id:"login.continue",path:"/login/continue",element:e.jsx(re,{})}]}]}]),N=document.getElementById("p-login");N&&M(N).render(e.jsx(V,{router:ne}));
